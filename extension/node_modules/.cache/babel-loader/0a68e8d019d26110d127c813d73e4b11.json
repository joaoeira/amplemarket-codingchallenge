{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport Main from './Main/Main';\nimport { v4 as uuidv4 } from 'uuid';\nvar URL = \"http://localhost:5000\";\nvar wrapper = document.createElement('div');\nwrapper.id = 'extension-wrapper';\ndocument.body.appendChild(wrapper);\n\nfunction main() {\n  return _main.apply(this, arguments);\n}\n\nfunction _main() {\n  _main = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var sdk, eventListenerAdded, frameMounted;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return InboxSDK.load(2, \"sdk_gmailSnippet_74536b3008\");\n\n          case 2:\n            sdk = _context.sent;\n            eventListenerAdded = false;\n            frameMounted = false;\n            sdk.Compose.registerComposeViewHandler(function (composeView) {\n              if (sdk.User.getEmailAddress().includes(\"@gmail.com\")) {\n                composeView.addButton({\n                  title: \"My Nifty Button!\",\n                  iconUrl: 'https://lh3.googleusercontent.com/AEOBTuMlfOrUtW6ATvrQBtvO1LFMX2ZLqV8XAOXDc6yYQk0iLJBXJy_tB5xOve3_B2QlzUkcG5oQwAD6Mqg2O48n=w128-h128-e365-rj-sc0x00ffffff',\n                  onClick: function onClick(event) {\n                    if (!eventListenerAdded) {\n                      window.addEventListener(\"message\", function (e) {\n                        if (e.origin === URL) {\n                          if (e.data.action === \"postSnippetToBody\") {\n                            event.composeView.setBodyText(e.data.snippet);\n                          }\n\n                          if (e.data.action === \"getUser\") {\n                            var user = sdk.User.getEmailAddress();\n                            var message = {\n                              'action': \"setUser\",\n                              'user': user\n                            };\n                            document.getElementById(\"amplemarketExtension\").contentWindow.postMessage(message, \"*\");\n                          }\n\n                          if (e.data.action === \"saveSnippetFromBody\") {\n                            var snippetBody = event.composeView.getTextContent();\n                            console.log(snippetBody);\n                            var name = prompt(\"Please enter a name for your snippet\");\n                            fetch(URL + \"/api/addSnippet\", {\n                              method: 'POST',\n                              mode: \"cors\",\n                              headers: {\n                                'Content-Type': 'application/json'\n                              },\n                              body: JSON.stringify({\n                                user: sdk.User.getEmailAddress(),\n                                snippet: snippetBody,\n                                name: name === \"\" ? \"Untitled\" : name,\n                                id: uuidv4(snippetBody)\n                              })\n                            }).then(function (res) {\n                              if (res.ok) {\n                                document.getElementById(\"amplemarketExtension\").contentWindow.postMessage({\n                                  'action': \"fetchContents\"\n                                }, \"*\");\n                              }\n                            })[\"catch\"](function (err) {\n                              return console.log(err);\n                            });\n                          }\n\n                          if (e.data.action === \"deleteSnippet\") {\n                            fetch(URL + \"/api/deleteSnippet\", {\n                              method: 'POST',\n                              mode: \"cors\",\n                              headers: {\n                                'Content-Type': 'application/json'\n                              },\n                              body: JSON.stringify({\n                                user: sdk.User.getEmailAddress(),\n                                id: e.data.id\n                              })\n                            }).then(function (res) {\n                              if (res.ok) {\n                                document.getElementById(\"amplemarketExtension\").contentWindow.postMessage({\n                                  'action': \"deleteSnippetSuccess\"\n                                }, \"*\");\n                              }\n                            })[\"catch\"](function (err) {\n                              return console.log(err);\n                            });\n                          }\n                        }\n                      });\n                    }\n\n                    eventListenerAdded = true;\n                    if (!frameMounted) ReactDOM.render( /*#__PURE__*/React.createElement(Main, null), document.getElementById('extension-wrapper'));\n                  }\n                });\n                composeView.on('destroy', function (event) {\n                  ReactDOM.render(null, document.getElementById('extension-wrapper'));\n                });\n              }\n            });\n\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _main.apply(this, arguments);\n}\n\nmain().then(function (res) {\n  return console.log(res);\n}, function (err) {\n  return console.log(err);\n});","map":{"version":3,"sources":["/home/joaoeira/Documents/amplemarket-gmailExtension/extension/src/js/snippetPlugin.js"],"names":["React","ReactDOM","Main","v4","uuidv4","URL","wrapper","document","createElement","id","body","appendChild","main","InboxSDK","load","sdk","eventListenerAdded","frameMounted","Compose","registerComposeViewHandler","composeView","User","getEmailAddress","includes","addButton","title","iconUrl","onClick","event","window","addEventListener","e","origin","data","action","setBodyText","snippet","user","message","getElementById","contentWindow","postMessage","snippetBody","getTextContent","console","log","name","prompt","fetch","method","mode","headers","JSON","stringify","then","res","ok","err","render","on"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,QAAP,MAAqB,WAArB;AAEA,OAAOC,IAAP,MAAiB,aAAjB;AAEA,SAASC,EAAE,IAAIC,MAAf,QAA6B,MAA7B;AAEA,IAAMC,GAAG,GAAG,uBAAZ;AAEA,IAAMC,OAAO,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAhB;AACEF,OAAO,CAACG,EAAR,GAAa,mBAAb;AACAF,QAAQ,CAACG,IAAT,CAAcC,WAAd,CAA0BL,OAA1B;;SAEaM,I;;;;;mEAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAEsBC,QAAQ,CAACC,IAAT,CAAc,CAAd,EAAgB,6BAAhB,CAFtB;;AAAA;AAEUC,YAAAA,GAFV;AAGQC,YAAAA,kBAHR,GAG6B,KAH7B;AAIQC,YAAAA,YAJR,GAIuB,KAJvB;AAKIF,YAAAA,GAAG,CAACG,OAAJ,CAAYC,0BAAZ,CAAuC,UAASC,WAAT,EAAqB;AACxD,kBAAGL,GAAG,CAACM,IAAJ,CAASC,eAAT,GAA2BC,QAA3B,CAAoC,YAApC,CAAH,EAAqD;AACnDH,gBAAAA,WAAW,CAACI,SAAZ,CAAsB;AACpBC,kBAAAA,KAAK,EAAE,kBADa;AAEpBC,kBAAAA,OAAO,EAAE,2JAFW;AAGpBC,kBAAAA,OAAO,EAAE,iBAASC,KAAT,EAAgB;AACvB,wBAAG,CAACZ,kBAAJ,EAAuB;AACrBa,sBAAAA,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmC,UAAAC,CAAC,EAAI;AACtC,4BAAGA,CAAC,CAACC,MAAF,KAAa3B,GAAhB,EAAoB;AAClB,8BAAG0B,CAAC,CAACE,IAAF,CAAOC,MAAP,KAAkB,mBAArB,EAAyC;AACvCN,4BAAAA,KAAK,CAACR,WAAN,CAAkBe,WAAlB,CAA8BJ,CAAC,CAACE,IAAF,CAAOG,OAArC;AACD;;AACD,8BAAGL,CAAC,CAACE,IAAF,CAAOC,MAAP,KAAkB,SAArB,EAA+B;AAC7B,gCAAMG,IAAI,GAAGtB,GAAG,CAACM,IAAJ,CAASC,eAAT,EAAb;AACA,gCAAMgB,OAAO,GAAG;AACd,wCAAU,SADI;AAEd,sCAAQD;AAFM,6BAAhB;AAIA9B,4BAAAA,QAAQ,CAACgC,cAAT,CAAwB,sBAAxB,EAAgDC,aAAhD,CAA8DC,WAA9D,CAA0EH,OAA1E,EAAmF,GAAnF;AACD;;AAED,8BAAGP,CAAC,CAACE,IAAF,CAAOC,MAAP,KAAkB,qBAArB,EAA2C;AACzC,gCAAMQ,WAAW,GAAGd,KAAK,CAACR,WAAN,CAAkBuB,cAAlB,EAApB;AACAC,4BAAAA,OAAO,CAACC,GAAR,CAAYH,WAAZ;AACA,gCAAMI,IAAI,GAAGC,MAAM,CAAC,sCAAD,CAAnB;AACAC,4BAAAA,KAAK,CAAC3C,GAAG,GAAC,iBAAL,EAAwB;AAC3B4C,8BAAAA,MAAM,EAAE,MADmB;AAE3BC,8BAAAA,IAAI,EAAE,MAFqB;AAG3BC,8BAAAA,OAAO,EAAE;AACP,gDAAgB;AADT,+BAHkB;AAM3BzC,8BAAAA,IAAI,EAAE0C,IAAI,CAACC,SAAL,CAAe;AACnBhB,gCAAAA,IAAI,EAAEtB,GAAG,CAACM,IAAJ,CAASC,eAAT,EADa;AAEnBc,gCAAAA,OAAO,EAAEM,WAFU;AAGnBI,gCAAAA,IAAI,EAAEA,IAAI,KAAK,EAAT,GAAc,UAAd,GAA2BA,IAHd;AAInBrC,gCAAAA,EAAE,EAAEL,MAAM,CAACsC,WAAD;AAJS,+BAAf;AANqB,6BAAxB,CAAL,CAaCY,IAbD,CAaM,UAAAC,GAAG,EAAI;AACX,kCAAGA,GAAG,CAACC,EAAP,EAAU;AACRjD,gCAAAA,QAAQ,CAACgC,cAAT,CAAwB,sBAAxB,EAAgDC,aAAhD,CAA8DC,WAA9D,CAA0E;AACxE,4CAAU;AAD8D,iCAA1E,EAEG,GAFH;AAGD;AACF,6BAnBD,WAoBO,UAAAgB,GAAG;AAAA,qCAAGb,OAAO,CAACC,GAAR,CAAYY,GAAZ,CAAH;AAAA,6BApBV;AAqBD;;AAED,8BAAG1B,CAAC,CAACE,IAAF,CAAOC,MAAP,KAAkB,eAArB,EAAqC;AACnCc,4BAAAA,KAAK,CAAC3C,GAAG,GAAC,oBAAL,EAA2B;AAC9B4C,8BAAAA,MAAM,EAAE,MADsB;AAE9BC,8BAAAA,IAAI,EAAE,MAFwB;AAG9BC,8BAAAA,OAAO,EAAE;AACP,gDAAgB;AADT,+BAHqB;AAM9BzC,8BAAAA,IAAI,EAAE0C,IAAI,CAACC,SAAL,CAAe;AACnBhB,gCAAAA,IAAI,EAAEtB,GAAG,CAACM,IAAJ,CAASC,eAAT,EADa;AAEnBb,gCAAAA,EAAE,EAAEsB,CAAC,CAACE,IAAF,CAAOxB;AAFQ,+BAAf;AANwB,6BAA3B,CAAL,CAWC6C,IAXD,CAWM,UAAAC,GAAG,EAAI;AACX,kCAAGA,GAAG,CAACC,EAAP,EAAU;AACRjD,gCAAAA,QAAQ,CAACgC,cAAT,CAAwB,sBAAxB,EAAgDC,aAAhD,CAA8DC,WAA9D,CAA0E;AACxE,4CAAU;AAD8D,iCAA1E,EAEG,GAFH;AAGD;AACF,6BAjBD,WAkBO,UAAAgB,GAAG;AAAA,qCAAGb,OAAO,CAACC,GAAR,CAAYY,GAAZ,CAAH;AAAA,6BAlBV;AAmBD;AACF;AAAC,uBA9DJ;AA+DD;;AACDzC,oBAAAA,kBAAkB,GAAC,IAAnB;AACA,wBAAG,CAACC,YAAJ,EAAkBhB,QAAQ,CAACyD,MAAT,eAAgB,oBAAC,IAAD,OAAhB,EAAyBnD,QAAQ,CAACgC,cAAT,CAAwB,mBAAxB,CAAzB;AACnB;AAvEmB,iBAAtB;AAyEAnB,gBAAAA,WAAW,CAACuC,EAAZ,CAAe,SAAf,EAA0B,UAAS/B,KAAT,EAAgB;AACxC3B,kBAAAA,QAAQ,CAACyD,MAAT,CAAgB,IAAhB,EAAqBnD,QAAQ,CAACgC,cAAT,CAAwB,mBAAxB,CAArB;AACD,iBAFD;AAGD;AACF,aA/EH;;AALJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAuFA3B,IAAI,GAAG0C,IAAP,CAAY,UAAAC,GAAG;AAAA,SAAIX,OAAO,CAACC,GAAR,CAAYU,GAAZ,CAAJ;AAAA,CAAf,EAAqC,UAAAE,GAAG;AAAA,SAAIb,OAAO,CAACC,GAAR,CAAYY,GAAZ,CAAJ;AAAA,CAAxC","sourcesContent":["import React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport Main from './Main/Main'\n\nimport { v4 as uuidv4 } from 'uuid';\n\nconst URL = \"http://localhost:5000\"\n\nconst wrapper = document.createElement('div')\n  wrapper.id = 'extension-wrapper'\n  document.body.appendChild(wrapper)\n\nasync function main(){\n    \n    const sdk = await InboxSDK.load(2,\"sdk_gmailSnippet_74536b3008\")\n    let eventListenerAdded = false;\n    let frameMounted = false;\n    sdk.Compose.registerComposeViewHandler(function(composeView){\n        if(sdk.User.getEmailAddress().includes(\"@gmail.com\")){\n          composeView.addButton({\n            title: \"My Nifty Button!\",\n            iconUrl: 'https://lh3.googleusercontent.com/AEOBTuMlfOrUtW6ATvrQBtvO1LFMX2ZLqV8XAOXDc6yYQk0iLJBXJy_tB5xOve3_B2QlzUkcG5oQwAD6Mqg2O48n=w128-h128-e365-rj-sc0x00ffffff',\n            onClick: function(event) {\n              if(!eventListenerAdded){\n                window.addEventListener(\"message\", e => {\n                  if(e.origin === URL){\n                    if(e.data.action === \"postSnippetToBody\"){\n                      event.composeView.setBodyText(e.data.snippet)\n                    }\n                    if(e.data.action === \"getUser\"){\n                      const user = sdk.User.getEmailAddress()\n                      const message = {\n                        'action': \"setUser\",\n                        'user': user\n                      }\n                      document.getElementById(\"amplemarketExtension\").contentWindow.postMessage(message, \"*\")\n                    }\n\n                    if(e.data.action === \"saveSnippetFromBody\"){\n                      const snippetBody = event.composeView.getTextContent();\n                      console.log(snippetBody)\n                      const name = prompt(\"Please enter a name for your snippet\")\n                      fetch(URL+\"/api/addSnippet\", {\n                        method: 'POST',\n                        mode: \"cors\",\n                        headers: {\n                          'Content-Type': 'application/json'\n                        },\n                        body: JSON.stringify({\n                          user: sdk.User.getEmailAddress(),\n                          snippet: snippetBody,\n                          name: name === \"\" ? \"Untitled\" : name,\n                          id: uuidv4(snippetBody)\n                        })\n                      })\n                      .then(res => {\n                        if(res.ok){\n                          document.getElementById(\"amplemarketExtension\").contentWindow.postMessage({\n                            'action': \"fetchContents\",\n                          }, \"*\")\n                        }\n                      })\n                      .catch(err=> console.log(err));\n                    }\n                    \n                    if(e.data.action === \"deleteSnippet\"){\n                      fetch(URL+\"/api/deleteSnippet\", {\n                        method: 'POST',\n                        mode: \"cors\",\n                        headers: {\n                          'Content-Type': 'application/json'\n                        },\n                        body: JSON.stringify({\n                          user: sdk.User.getEmailAddress(),\n                          id: e.data.id\n                        })\n                      })\n                      .then(res => {\n                        if(res.ok){\n                          document.getElementById(\"amplemarketExtension\").contentWindow.postMessage({\n                            'action': \"deleteSnippetSuccess\",\n                          }, \"*\")\n                        }\n                      })\n                      .catch(err=> console.log(err));\n                    }\n                  }})\n              }\n              eventListenerAdded=true;\n              if(!frameMounted) ReactDOM.render(<Main />,document.getElementById('extension-wrapper'))\n            },\n          });\n          composeView.on('destroy', function(event) {\n            ReactDOM.render(null,document.getElementById('extension-wrapper'))\n          });\n        }\n      })\n      ;\n}\nmain().then(res => console.log(res), err => console.log(err))\n\n\n\n"]},"metadata":{},"sourceType":"module"}